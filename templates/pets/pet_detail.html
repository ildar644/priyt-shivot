{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ pet.name }} - –ü–∏—Ç–æ–º–µ—Ü –∏–∑ –ø—Ä–∏—é—Ç–∞</title>
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
</head>
<body>
    <div class="container">
        {% include 'includes/nav.html' %}

        <div class="pet-detail-container">
            <a href="{% url 'pet_list' %}" class="back-btn">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>

            <div class="pet-header">
            <div class="pet-photo">
                {% if pet.photo %}
                    <img src="{{ pet.photo.url }}" alt="{{ pet.name }}">
                {% else %}
                    <div style="width: 100%; height: 300px; background: #ddd; display: flex; align-items: center; justify-content: center; border-radius: 10px;">
                        <span style="color: #999; font-size: 18px;">–§–æ—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</span>
                    </div>
                {% endif %}
            </div>
            
            <div class="pet-basic-info">
                <h1>{{ pet.name }}</h1>
                
                <div class="info-item">
                    <span class="info-label">–¢–∏–ø:</span> 
                    <span class="info-value">{{ pet.pet_type.name }}</span>
                </div>
                
                <div class="info-item">
                    <span class="info-label">–í–æ–∑—Ä–∞—Å—Ç:</span> 
                    <span class="info-value">{{ pet.age_in_years }}</span>
                </div>
                
                <div class="info-item">
                    <span class="info-label">–ü—Ä–∏—é—Ç:</span> 
                    <span class="info-value">{{ pet.shelter.name }}</span>
                </div>
                
                <div class="info-item">
                    <span class="info-label">–°—Ç–∞—Ç—É—Å:</span> 
                    {% if pet.is_adopted %}
                        <span class="status-adopted">‚úÖ –£—Å—ã–Ω–æ–≤–ª–µ–Ω</span>
                    {% else %}
                        <span class="status-available">‚ù§Ô∏è –ò—â–µ—Ç –¥–æ–º</span>
                    {% endif %}
                </div>
                
                <div class="info-item">
                    <span class="info-label">–î–æ–±–∞–≤–ª–µ–Ω:</span> 
                    <span class="info-value">{{ pet.date_added|date:"d.m.Y" }}</span>
                </div>
                
                {% if user.is_authenticated %}
                    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —É—Å—ã–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö -->
                    {% if not pet.is_adopted %}
                        {% if user_application %}
                            <div class="application-status-main">
                                <div class="status-card">
                                    <span class="status-badge status-{{ user_application.status }}">
                                        {{ user_application.get_status_display }}
                                    </span>
                                    <div class="status-details">
                                        <p><strong>–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –Ω–∞ —É—Å—ã–Ω–æ–≤–ª–µ–Ω–∏–µ {{ pet.name }}</strong></p>
                                        <small>–ü–æ–¥–∞–Ω–∞ {{ user_application.date_created|date:"d.m.Y –≤ H:i" }}</small>
                                    </div>
                                </div>
                            </div>
                        {% else %}
                            <div class="adoption-cta">
                                <a href="{% url 'adoption_application' pet.pk %}" class="btn-adopt-main">
                                    üè† –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ —É—Å—ã–Ω–æ–≤–ª–µ–Ω–∏–µ {{ pet.name }}
                                </a>
                                <p class="adoption-note">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∞–Ω–∫–µ—Ç—É, –∏ –º—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏</p>
                            </div>
                        {% endif %}
                    {% endif %}
                {% else %}
                    <!-- –ë–ª–æ–∫ –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                    {% if not pet.is_adopted %}
                        <div class="adoption-cta-login">
                            <div class="login-required-message">
                                <h3>üîê –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h3>
                                <p>–ß—Ç–æ–±—ã –ø–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ —É—Å—ã–Ω–æ–≤–ª–µ–Ω–∏–µ {{ pet.name }}, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</p>
                                <div class="auth-buttons">
                                    <a href="{% url 'login' %}" class="btn-login-main">
                                        üîë –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
                                    </a>
                                    <a href="{% url 'signup' %}" class="btn-signup-main">
                                        üìù –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                                    </a>
                                </div>
                                <p class="auth-note">–ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –≤—ã —Å–º–æ–∂–µ—Ç–µ –ø–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ —É—Å—ã–Ω–æ–≤–ª–µ–Ω–∏–µ</p>
                            </div>
                        </div>
                    {% endif %}
                {% endif %}
                
                <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
                {% if user.is_authenticated %}
                    <div class="pet-actions-secondary">
                        {% if is_favorite %}
                            <a href="{% url 'remove_from_favorites' pet.pk %}" class="btn-action btn-favorite-remove">üíñ –£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ</a>
                        {% else %}
                            <a href="{% url 'add_to_favorites' pet.pk %}" class="btn-action">‚ù§Ô∏è –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
                        {% endif %}
                        <a href="{% url 'sponsor_pet' pet.pk %}" class="btn-action btn-sponsor">üíù –ü–æ–º–æ—á—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ</a>
                    </div>
                {% endif %}
            </div>
        </div>

        <div class="section">
            <h2>–ò—Å—Ç–æ—Ä–∏—è –ø–∏—Ç–æ–º—Ü–∞</h2>
            <p>{{ pet.history|linebreaks }}</p>
        </div>

        <div class="section">
            <h2>–•–∞—Ä–∞–∫—Ç–µ—Ä</h2>
            <p>{{ pet.character|linebreaks }}</p>
        </div>

        {% if pet.special_needs %}
        <div class="section">
            <h2>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</h2>
            <p>{{ pet.special_needs|linebreaks }}</p>
        </div>
        {% endif %}

        <div class="section contact-info">
            <h2>üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –ø—Ä–∏—é—Ç–∞</h2>
            <div class="info-item">
                <span class="info-label">–ù–∞–∑–≤–∞–Ω–∏–µ:</span> 
                <span class="info-value">{{ pet.shelter.name }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">–ê–¥—Ä–µ—Å:</span> 
                <span class="info-value">{{ pet.shelter.address }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">–¢–µ–ª–µ—Ñ–æ–Ω:</span> 
                <span class="info-value">{{ pet.shelter.phone }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">Email:</span> 
                <span class="info-value">{{ pet.shelter.email }}</span>
            </div>
            {% if pet.shelter.website %}
            <div class="info-item">
                <span class="info-label">–°–∞–π—Ç:</span> 
                <span class="info-value"><a href="{{ pet.shelter.website }}" target="_blank">{{ pet.shelter.website }}</a></span>
            </div>
            {% endif %}
        </div>

        <!-- –°–µ–∫—Ü–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
        <div class="section">
            <h2>üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h2>
            
            {% if user.is_authenticated %}
                <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
                <div class="comment-form-section">
                    <h3>–û—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h3>
                    <form method="post" action="{% url 'add_comment' pet.pk %}" class="comment-form">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="{{ comment_form.content.id_for_label }}">{{ comment_form.content.label }}</label>
                            {{ comment_form.content }}
                        </div>
                        <button type="submit" class="btn-comment">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</button>
                    </form>
                </div>
            {% else %}
                <div class="login-prompt">
                    <p><a href="{% url 'login' %}">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</p>
                </div>
            {% endif %}

            <!-- –°–ø–∏—Å–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
            <div class="comments-list">
                {% if comments %}
                    {% for comment in comments %}
                        <div class="comment-item">
                            <div class="comment-header">
                                <strong class="comment-author">{{ comment.user.username }}</strong>
                                <span class="comment-date">{{ comment.date_created|date:"d.m.Y H:i" }}</span>
                                {% if user == comment.user %}
                                    <a href="{% url 'delete_comment' comment.id %}" 
                                       class="delete-comment" 
                                       onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π?')">
                                        üóëÔ∏è
                                    </a>
                                {% endif %}
                            </div>
                            <div class="comment-content">
                                {{ comment.content|linebreaks }}
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="no-comments">
                        <p>–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
                    </div>
                {% endif %}
            </div>
        </div>
        </div>
    </div>
</body>
</html>
